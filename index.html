<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vol. 18 두께 계산</title>
  <style>
    html,body{height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.45;max-width:1100px;margin:24px auto;padding:0 16px}
    h1{font-size:1.6rem;margin:0 0 10px}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:1fr 1fr; column-gap:24px}
    @media (max-width:740px){.grid-2{grid-template-columns:1fr}}
    .card{border:1px solid #ddd;border-radius:14px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.05);margin:10px 0;background:#fff}
    label{display:block;font-weight:600;margin:.4rem 0 .3rem}
    input,select{font-size:1rem;width:100%;padding:.7rem .8rem;border:1px solid #ccc;border-radius:10px;box-sizing:border-box}
    .out{background:#fafafa;border:1px dashed #ddd;border-radius:10px;padding:12px;margin-top:8px}
    table{width:100%;border-collapse:collapse;margin-top:8px;table-layout:fixed}
    th,td{border:1px solid #e4e4e4;padding:8px;text-align:center;word-break:keep-all}
    th{background:#f6f6f6}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-weight:700}
    .ok{background:#e7f7ee;color:#0a7f55}
    .warn{background:#fff7e6;color:#b06900;border:1px solid #ffe1a7}
    .no{background:#fdeceb;color:#b42318}
    .muted{color:#666;font-size:.92rem}
    .small{font-size:.9rem}
    .big{font-size:1.6rem;font-weight:800}
    .toggle{cursor:pointer;user-select:none;display:flex;align-items:center;gap:8px}
    .caret{transition:transform .2s ease}
    .collapsed .caret{transform:rotate(-90deg)}
    .hidden{display:none}
    .details{margin-top:8px}
    .details code{background:#f3f3f3;border-radius:6px;padding:2px 6px}
    .catwrap{display:grid;grid-template-columns:repeat(4,1fr); gap:10px; margin-top:8px}
    @media (max-width:740px){.catwrap{grid-template-columns:repeat(2,1fr)}}
    .catbtn{height:42px; display:flex; align-items:center; justify-content:center;
            border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer; font-weight:700;}
    .catbtn.active{background:#111;color:#fff;border-color:#111}
  </style>
</head>

<body>
  <h1>Vol.18 두께 계산</h1>

  <div class="card">
    <div class="grid grid-2">
      <div>
        <label>높이 (mm)</label>
        <input id="height" type="number" step="0.001" value="1000" />
      </div>
      <div>
        <label>튜브</label>
        <select id="tube"></select>
        <div class="small muted">튜브 목록은 아래에서 펼쳐서 확인 가능</div>
      </div>
    </div>

    <div style="margin-top:10px">
      <label>원단 카테고리</label>
      <div class="catwrap" id="catwrap"></div>
    </div>

    <div style="margin-top:8px">
      <label>원단 종류</label>
      <select id="fabric"></select>
    </div>

    <div class="out" style="margin-top:12px">
      <div>전체 두께 <span class="big" id="g6">-</span> mm</div>
      <div id="detailToggle" class="toggle collapsed">
        <span class="caret">▶</span><span class="muted small">상세 보기 (지름·공식·중간값)</span>
      </div>
      <div id="details" class="details hidden small">
        <div>지름 = <b id="diameter">-</b> mm, 원단 두께/피치 = <b id="e6">-</b></div>
        <div>공식: <code>I = ((-2π·지름) + √((2π·지름)^2 + 8π·높이·원단두께)) / (2π·원단두께)</code></div>
        <div>I = <b id="i6">-</b></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>커버별 최대 두께 & 적용 가능 여부</h3>
    <table id="limitTable">
      <thead>
        <tr><th>커버</th><th>최대 두께</th><th>적용 가능 여부</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="card collapsed" id="tubeCard">
    <div class="toggle" id="tubeToggle">
      <span class="caret">▶</span><h3 style="margin:0">튜브 목록 (접기/펼치기)</h3>
    </div>
    <div id="tubeList" class="hidden">
      <table>
        <thead><tr><th>튜브</th><th>튜브무게</th><th>지름</th></tr></thead>
        <tbody id="tubeTable"></tbody>
      </table>
    </div>
  </div>

  <!-- ✅ 내장 데이터(JSON) : "관리자/로컬스토리지/비밀번호" 관련 데이터 제거 -->
  <script id="data-json" type="application/json">
  {
    "groups": {
      "Innowin": [
        {"display":"◎ Innocence 75mm","original":"◎ Innocence 75mm","e6":0.49},
        {"display":"Shangrila Solid","original":"Shangrila Solid","e6":0.62},
        {"display":"Shangrila Blackout","original":"Shangrila Blackout","e6":0.76},
        {"display":"Innocence 75mm","original":"Innocence 75mm","e6":0.49}
      ],
      "Twins": [
        {"display":"◎ TWG Gold","original":"◎ TWG Gold","e6":0.35},
        {"display":"◎ Metal","original":"◎ Metal","e6":0.34},
        {"display":"◎ Amber","original":"◎ Amber","e6":0.27},
        {"display":"Sparkle","original":"Sparkle","e6":0.46}
      ],
      "Combi": [
        {"display":"◎ Acaba2 (Semi Blackout)","original":"◎ Acaba2 (Semi Blackout)","e6":0.51},
        {"display":"◎ Alpine","original":"◎ Alpine","e6":0.29},
        {"display":"◎ Belita","original":"◎ Belita","e6":0.48},
        {"display":"◎ Celestial","original":"◎ Celestial","e6":0.32},
        {"display":"◎ Evere (Semi Blackout)","original":"◎ Evere (Semi Blackout)","e6":0.42},
        {"display":"◎ Daisy (Semi Blackout)","original":"◎ Daisy (Semi Blackout)","e6":0.42},
        {"display":"◎ Delos (Blackout)","original":"◎ Delos (Blackout)","e6":0.49},
        {"display":"◎ Lento (Semi Blackout)","original":"◎ Lento (Semi Blackout)","e6":0.49},
        {"display":"◎ Lewis","original":"◎ Lewis","e6":0.35},
        {"display":"◎ Linen B/O (Semi Blackout)","original":"◎ Linen B/O (Semi Blackout)","e6":0.69},
        {"display":"◎ Malta","original":"◎ Malta","e6":0.37},
        {"display":"◎ Bailey","original":"◎ Bailey","e6":0.29},
        {"display":"◎ Abyss","original":"◎ Abyss","e6":0.26},
        {"display":"◎ Camilla (Blackout)","original":"◎ Camilla (Blackout)","e6":0.45},
        {"display":"◎ Timberlook","original":"◎ Timberlook","e6":0.45},
        {"display":"◎ Parma (Blackout)","original":"◎ Parma (Blackout)","e6":0.49},
        {"display":"Naomi (Semi Blackout)","original":"Naomi (Semi Blackout)","e6":0.62},
        {"display":"Dublin","original":"Dublin","e6":0.34},
        {"display":"Lafia (Semi Blackout)","original":"Lafia (Semi Blackout)","e6":0.5},
        {"display":" Lydia (Blackout/Non-Blackout)","original":" Lydia (Blackout/Non-Blackout)","e6":0.44},
        {"display":"Libera","original":"Libera","e6":0.28},
        {"display":"Linen Zebra","original":"Linen Zebra","e6":0.33},
        {"display":"Monaco","original":"Monaco","e6":0.51},
        {"display":"Morning FR","original":"Morning FR","e6":0.25},
        {"display":"Viar (Semi Blackout)","original":"Viar (Semi Blackout)","e6":0.46},
        {"display":"Bilbao (Semi Blackout)","original":"Bilbao (Semi Blackout)","e6":0.67},
        {"display":"Cezanne (Blackout)","original":"Cezanne (Blackout)","e6":0.6},
        {"display":"Adela F/R (Semi Blackout)","original":"Adela F/R (Semi Blackout)","e6":0.43},
        {"display":"Andorra (Semi Blackout)","original":"Andorra (Semi Blackout)","e6":0.42},
        {"display":"Olive","original":"Olive","e6":0.61},
        {"display":"Karaman (Blackout)","original":"Karaman (Blackout)","e6":0.42},
        {"display":"Krabi","original":"Krabi","e6":0.43},
        {"display":"Phoenix (Semi Blackout)","original":"Phoenix (Semi Blackout)","e6":0.5}
      ],
      "Roll": [
        {"display":"◎ Coral","original":"◎ Coral","e6":0.33},
        {"display":"◎ Halong Bay","original":"◎ Halong Bay","e6":0.44},
        {"display":"◎ Polar night Blackout F.R","original":"◎ Polar night Blackout F.R","e6":0.6},
        {"display":"◎ Glitter ","original":"◎ Glitter ","e6":0.31},
        {"display":"◎ Lenola Foam (Blackout)","original":"◎ Lenola Foam (Blackout)","e6":0.48},
        {"display":"◎ Rain","original":"◎ Rain","e6":0.34},
        {"display":"◎ Makalu Form (Blackout)","original":"◎ Makalu Form (Blackout)","e6":0.45},
        {"display":"◎ Mestia ","original":"◎ Mestia ","e6":0.35},
        {"display":"◎ Millet (Perfect) (Blackout) ","original":"◎ Millet (Perfect) (Blackout) ","e6":0.58},
        {"display":"◎ Vivid ","original":"◎ Vivid ","e6":0.38},
        {"display":"◎ Sunscreen 4TW ","original":"◎ Sunscreen 4TW ","e6":0.75},
        {"display":"◎ Sunflat F.R","original":"◎ Sunflat F.R","e6":0.38},
        {"display":"◎ Ecoscreen foam (Blackout) ","original":"◎ Ecoscreen foam (Blackout) ","e6":0.72},
        {"display":"◎ Ecoflat ","original":"◎ Ecoflat ","e6":0.38},
        {"display":"◎ Elvas ","original":"◎ Elvas ","e6":0.3},
        {"display":"◎ Cherokee Foam (Blackout)","original":"◎ Cherokee Foam (Blackout)","e6":0.61},
        {"display":"◎ Tahiti ","original":"◎ Tahiti ","e6":0.33},
        {"display":"◎ Trevi ","original":"◎ Trevi ","e6":0.47},
        {"display":"Marina Foam F.R (Blackout)","original":"Marina Foam F.R (Blackout)","e6":0.64},
        {"display":"Marina Foam (Blackout)","original":"Marina Foam (Blackout)","e6":0.64},
        {"display":"Radena F.R","original":"Radena F.R","e6":0.35},
        {"display":"VGR B/O","original":"VGR B/O","e6":0.41},
        {"display":"Granada","original":"Granada","e6":0.3},
        {"display":"Grend F.R","original":"Grend F.R","e6":0.48},
        {"display":"Nouvelle F.R (Blackout)","original":"Nouvelle F.R (Blackout)","e6":0.27},
        {"display":"Lamong","original":"Lamong","e6":0.35},
        {"display":"Sunscreen Rex 5%","original":"Sunscreen Rex 5%","e6":0.58},
        {"display":"Mild","original":"Mild","e6":0.35},
        {"display":"Morea","original":"Morea","e6":0.46},
        {"display":"Salt Lake Foam (Blackout) ","original":"Salt Lake Foam (Blackout) ","e6":0.35},
        {"display":"Sindy F.R","original":"Sindy F.R","e6":0.37},
        {"display":"Sunscreen 3N 1%","original":"Sunscreen 3N 1%","e6":0.68},
        {"display":"Sunscreen 3N 1% Metal","original":"Sunscreen 3N 1% Metal","e6":0.68},
        {"display":"Sunscreen 3N 3%","original":"Sunscreen 3N 3%","e6":0.57},
        {"display":"Sunscreen 3N 3% Metal","original":"Sunscreen 3N 3% Metal","e6":0.57},
        {"display":"Sunscreen 4DP (1%)","original":"Sunscreen 4DP (1%)","e6":1.0},
        {"display":"Sunscreen 4N (3%)","original":"Sunscreen 4N (3%)","e6":0.77},
        {"display":"Sunhill","original":"Sunhill","e6":0.56},
        {"display":"Ariji","original":"Ariji","e6":0.73},
        {"display":"Ecoscreen F.R","original":"Ecoscreen F.R","e6":0.53},
        {"display":"Excel F.R (Blackout) ","original":"Excel F.R (Blackout)","e6":0.28},
        {"display":"Wellington Foam (Blackout)","original":"Wellington Foam (Blackout)","e6":0.5},
        {"display":"Jade","original":"Jade","e6":0.78},
        {"display":"County","original":"County","e6":0.4},
        {"display":"Capri (Blackout/Non-Blackout)","original":"Capri (Blackout/Non-Blackout)","e6":0.5},
        {"display":"Cosca Foam (Blackout)","original":"Cosca Foam (Blackout)","e6":0.5},
        {"display":"Torino F.R (Blackout)","original":"Torino F.R (Blackout)","e6":0.72},
        {"display":"Pastel F.R","original":"Pastel F.R","e6":0.35},
        {"display":"Sunscreen Haim 3%","original":"Sunscreen Haim 3%","e6":0.86},
        {"display":"Hatchland","original":"Hatchland","e6":0.4},
        {"display":"White Garden","original":"White Garden","e6":0.35}
      ]
    },
    "tubes": [
      {"name":"Winhouse tube(25ø)","weight":0.228,"diameter":25},
      {"name":"Combi/Roll tube(30ø)","weight":0.216,"diameter":30},
      {"name":"Jumbo tube(38ø)","weight":0.330,"diameter":38},
      {"name":"Winhouse Jumbo tube(38ø)","weight":0.306,"diameter":38},
      {"name":"Triple tube(38ø)","weight":0.348,"diameter":38},
      {"name":"Triple tube(40ø)","weight":0.410,"diameter":40},
      {"name":"Winhouse Jumbo tube(45ø)","weight":0.588,"diameter":45},
      {"name":"Junshade tube(47ø)","weight":0.773,"diameter":47},
      {"name":"Somfy tube(47ø)","weight":0.469,"diameter":47},
      {"name":"Junshade tube(57ø)","weight":0.946,"diameter":57},
      {"name":"Somfy tube(57ø)","weight":1.026,"diameter":57},
      {"name":"95mm Innocence(57ø)","weight":0.648,"diameter":57},
      {"name":"70ø tube","weight":1.463,"diameter":70},
      {"name":"90ø tube","weight":2.327,"diameter":90}
    ],
    "defaults": {
      "height": 1000,
      "tube": "Combi/Roll tube(30ø)",
      "group": "Innowin",
      "fabric_original": "◎ Innocence 75mm"
    },
    "limits": [
      {"name":"Round Corner Cover (small)","limit":60},
      {"name":"Round Corner Cover (medium)","limit":75},
      {"name":"Round Corner Cover (large)","limit":90},
      {"name":"Prime Cover","limit":65},
      {"name":"Square Cover (small)","limit":60},
      {"name":"Square Cover (medium)","limit":65}
    ]
  }
  </script>

  <script>
    const $ = (id)=>document.getElementById(id);

    function getEmbedded(){
      const el = $("data-json");
      try{
        return JSON.parse((el.textContent || "").trim());
      }catch(e){
        console.error(e);
        alert("내장 데이터(JSON) 파싱 실패: " + e.message);
        return null;
      }
    }

    const DATA = getEmbedded();

    function getTube(name){
      return (DATA?.tubes || []).find(t => t.name === name);
    }

    function renderLimitRows(g6){
      const tb = document.querySelector("#limitTable tbody");
      tb.innerHTML = "";
      (DATA?.limits || []).forEach(row=>{
        let cls="no", label="불가능";
        if(g6>0){
          if(g6 <= row.limit - 3){ cls="ok"; label="가능"; }
          else if(g6 <= row.limit){ cls="warn"; label="가능(간섭위험)"; }
        }
        const tr=document.createElement("tr");
        tr.innerHTML = `
          <td>${row.name}</td>
          <td><b>${row.limit}</b></td>
          <td><span class="pill ${cls}">${label}</span></td>`;
        tb.appendChild(tr);
      });
    }

    function setCategory(cat){
      document.querySelectorAll(".catbtn").forEach(el=>{
        el.classList.toggle("active", el.dataset.cat === cat);
      });

      const fSel = $("fabric");
      fSel.innerHTML = "";

      const items = DATA.groups?.[cat] || [];
      items.forEach((it, i)=>{
        const o=document.createElement("option");
        o.value = it.original;
        o.textContent = it.display;
        // 기본 원단 지정(없으면 첫번째)
        const isDefault = (it.original === DATA.defaults?.fabric_original);
        if(i===0 || isDefault) o.selected = true;
        fSel.appendChild(o);
      });

      recalc();
    }

    function recalc(){
      const height = parseFloat($("height").value || 0);

      const tube = getTube($("tube").value);
      const diameter = tube ? Number(tube.diameter) : 0;

      const activeCat = document.querySelector(".catbtn.active")?.dataset.cat;
      // 원 코드 유지: Combi/Twins만 2배 적용
      const mult = (activeCat === "Combi" || activeCat === "Twins") ? 2 : 1;
      const effH = height * mult;

      const items = DATA.groups?.[activeCat] || [];
      const sel = items.find(it => it.original === $("fabric").value);
      const e6 = sel ? Number(sel.e6) : NaN;

      let I = NaN, G = NaN;
      if(effH >= 0 && diameter > 0 && e6 > 0){
        I = ((-2*Math.PI*diameter) + Math.sqrt((2*Math.PI*diameter)**2 + 8*Math.PI*effH*e6)) / (2*Math.PI*e6);
        G = diameter + 2*I*e6;
      }

      $("g6").textContent = Number.isFinite(G) ? G.toFixed(1) : "-";
      $("diameter").textContent = Number.isFinite(diameter) ? String(diameter) : "-";
      $("e6").textContent = Number.isFinite(e6) ? String(e6) : "-";
      $("i6").textContent = Number.isFinite(I) ? I.toFixed(3) : "-";

      renderLimitRows(Number.isFinite(G) ? G : 0);
    }

    function init(){
      if(!DATA) return;

      // 기본 높이
      if(DATA.defaults?.height != null) $("height").value = DATA.defaults.height;

      // 튜브 선택
      const tSel = $("tube");
      tSel.innerHTML = "";
      (DATA.tubes || []).forEach(t=>{
        const o=document.createElement("option");
        o.value = t.name;
        o.textContent = t.name;
        if(t.name === DATA.defaults?.tube) o.selected = true;
        tSel.appendChild(o);
      });

      // 카테고리 버튼
      const cw = $("catwrap");
      cw.innerHTML = "";
      Object.keys(DATA.groups || {}).forEach(cat=>{
        const b=document.createElement("button");
        b.type = "button";
        b.className = "catbtn" + (cat === DATA.defaults?.group ? " active" : "");
        b.textContent = cat;
        b.dataset.cat = cat;
        b.addEventListener("click", ()=>setCategory(cat));
        cw.appendChild(b);
      });

      // 튜브 표
      const tBody = $("tubeTable");
      tBody.innerHTML = "";
      (DATA.tubes || []).forEach(t=>{
        const tr=document.createElement("tr");
        tr.innerHTML = `<td>${t.name}</td><td>${t.weight}</td><td>${t.diameter}</td>`;
        tBody.appendChild(tr);
      });

      // 카테고리 초기 선택 (없으면 첫번째)
      const firstCat = Object.keys(DATA.groups || {})[0];
      setCategory(DATA.defaults?.group || firstCat);

      // 초기 limit 렌더
      renderLimitRows(0);

      // 이벤트
      ["height","tube","fabric"].forEach(id=>{
        $(id).addEventListener("input", recalc);
        $(id).addEventListener("change", recalc);
      });

      // 상세 토글
      $("detailToggle").addEventListener("click", ()=>{
        const wrap = $("detailToggle");
        const el = $("details");
        const open = el.classList.contains("hidden");
        el.classList.toggle("hidden", !open);
        wrap.classList.toggle("collapsed", !open);
      });

      // 튜브 리스트 토글
      $("tubeToggle").addEventListener("click", ()=>{
        const list = $("tubeList");
        const card = $("tubeCard");
        const open = list.classList.contains("hidden");
        list.classList.toggle("hidden", !open);
        card.classList.toggle("collapsed", !open);
      });

      // 최초 계산
      recalc();
    }

    init();
  </script>
</body>
</html>
